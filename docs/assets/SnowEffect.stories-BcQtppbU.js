import{r as w,R as y}from"./index-RYns6xqu.js";import{P as D,S as O,T,a as k,b as H,V as W,W as _}from"./three.module-DJIKMl97.js";const r=(t,a)=>Math.random()*(a-t)+t;function q(t,{amount:a=360,fallSpeed:v=2}){console.log("snow",t,{amount:a,fallSpeed:v});const d=t.clientWidth,f=t.clientHeight,o={frame:!0,width:d,height:f,aspect:d/f,halfX:d/2,halfY:f/2},n=new D(75,o.aspect,1,2e3);n.position.z=100;const p=new O,L=new T().load("/stories/assets/snow.png"),P=new k({map:L});let m=0,u=0;const S=[];for(let s=0;s<a;s++){const e=new H(P),c=r(10,20);e.position.x=r(-1e3,1e3),e.position.y=r(-1e3,1e3),e.position.z=r(-1e3,1e3),e.scale.x=e.scale.y=e.scale.z=c,e.userData.v=new W(0,-v,0),e.userData.v.z=1*r(-1,1),e.userData.v.x=1*r(-1,1),S.push(e),p.add(e)}const i=new _({alpha:!0});i.setPixelRatio(window.devicePixelRatio),i.setSize(o.width,o.height),t.appendChild(i.domElement),new ResizeObserver(s=>{const e=s[0],c=e.contentRect.width,h=e.contentRect.height;Object.assign(o,{frame:!0,width:c,height:h,aspect:c/h,halfX:c/2,halfY:h/2}),n.aspect=o.aspect,n.updateProjectionMatrix(),i.setSize(o.width,o.height)}).observe(t);const X=s=>{m=s.clientX-o.halfX,u=s.clientY-o.halfY},x=s=>{s.preventDefault(),m=s.touches[0].pageX-o.halfX,u=s.touches[0].pageY-o.halfY};document.addEventListener("mousemove",X,!1),document.addEventListener("touchstart",x,!1),document.addEventListener("touchmove",x,!1);const Y=()=>{for(const s of S){const e=s.position;e.add(s.userData.v),e.y<-1e3&&(e.y=1e3),e.x>1e3?e.x=-1e3:e.x<-1e3&&(e.x=1e3),e.z>1e3?e.z=-1e3:e.z<-1e3&&(e.z=1e3)}n.position.x+=(m-n.position.x)*5e-4,n.position.y+=(-u-n.position.y)*5e-4,n.lookAt(p.position),i.render(p,n)},E=()=>{o.frame&&(requestAnimationFrame(E),Y())};return E(),()=>{o.frame=!1}}function g(t){const a=w.useRef(null);return w.useEffect(()=>{a.current&&q(a.current,{amount:t.amount||360,fallSpeed:t.fallSpeed||2})}),console.log("SnowEffect@props",t),w.createElement("div",{ref:a,style:{position:"absolute",pointerEvents:"none",top:"0",left:"0",width:"100%",height:"100%"}})}g.__docgenInfo={description:"Three 雪花效果：天空飘落雪花。",methods:[],displayName:"SnowEffect",props:{amount:{required:!1,tsType:{name:"number"},description:"雪花密度"},fallSpeed:{required:!1,tsType:{name:"number"},description:"雪花坠落速度"}}};const G={title:"WebGL/SpecialEffect/SnowEffect",component:g},l={args:{amount:180,fallSpeed:2},render:t=>y.createElement("div",{className:"storybook-SnowEffect",style:C},y.createElement(g,{...t}))},C={width:"100%",height:"100%",minHeight:"320px",backgroundColor:"rgba(79, 89, 102, 0.88)",position:"relative"};var b,z,R;l.parameters={...l.parameters,docs:{...(b=l.parameters)==null?void 0:b.docs,source:{originalSource:`{
  args: {
    amount: 180,
    fallSpeed: 2
  },
  render: args => {
    return <div className="storybook-SnowEffect" style={style}>
        <SnowEffect {...args} />
      </div>;
  }
}`,...(R=(z=l.parameters)==null?void 0:z.docs)==null?void 0:R.source}}};const V=["Primary"];export{l as Primary,V as __namedExportsOrder,G as default};
